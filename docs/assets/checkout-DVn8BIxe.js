import{g as n,s as l,a as o}from"./utils-BZuxY1Lt.js";import{E as u}from"./ExternalServices-bTa7vZnK.js";const h=.06,m=10,d=2;function p(r){const t={};return r.forEach((s,e)=>{t[e]=s}),t}function g(r){return r.map(t=>({id:t.Id,name:t.Name,price:t.FinalPrice,quantity:t.quantity||1}))}class y{constructor(t){this.cartKey=t,this.items=n(this.cartKey)||[],this.subtotal=0,this.tax=0,this.shipping=0,this.total=0,this.services=new u}calculateItemSummary(){this.subtotal=this.items.reduce((s,e)=>s+e.FinalPrice*(e.quantity||1),0);const t=document.querySelector("#summary-subtotal");t&&(t.textContent=`$${this.subtotal.toFixed(2)}`)}calculateOrderTotals(){const t=this.items.length;t===0?this.shipping=0:this.shipping=m+d*(t-1),this.tax=this.subtotal*h,this.total=this.subtotal+this.tax+this.shipping,this.displayOrderTotals()}displayOrderTotals(){const t=document.querySelector("#summary-tax"),s=document.querySelector("#summary-shipping"),e=document.querySelector("#summary-total");t&&(t.textContent=`$${this.tax.toFixed(2)}`),s&&(s.textContent=`$${this.shipping.toFixed(2)}`),e&&(e.textContent=`$${this.total.toFixed(2)}`)}resetOrderTotals(){this.tax=0,this.shipping=0,this.total=0,this.displayOrderTotals()}async checkout(t){try{const s=new FormData(t),e=p(s);e.orderDate=new Date().toISOString(),e.items=g(this.items),e.orderTotal=this.total.toFixed(2),e.shipping=this.shipping,e.tax=this.tax.toFixed(2),await this.services.checkout(e),l(this.cartKey,[]),window.location.href="../checkout/success.html"}catch(s){s.name==="servicesError"?this.extractErrorMessages(s.message).forEach(c=>{o(c,!0)}):o("An error occurred during checkout. Please try again.",!0)}}extractErrorMessages(t){if(!t)return["An error occurred. Please try again."];if(typeof t=="string")return[t];const s=Object.values(t).filter(e=>typeof e=="string");return s.length===0?["Please check your information and try again."]:s}}const a=new y("so-cart");a.calculateItemSummary();a.resetOrderTotals();document.querySelector("#zip").addEventListener("blur",r=>{r.target.value.trim()?a.calculateOrderTotals():a.resetOrderTotals()});const i=document.querySelector("#checkout-form");i.addEventListener("submit",r=>{r.preventDefault();const t=i.checkValidity();i.reportValidity(),t&&a.checkout(i)});
